Title: О power management в Linux или как я отношусь к systemd.
Date: 2014-12-04 00:09
Authors: sbog
Slug: systemd_power_management
Tags: hibernate, linux, sleep, systemctl, жизньникогданебудетпрежней, systemd
Lang: ru

Последнее время в сети бурлят настроения по поводу того, хорошо ли
systemd или плохо, в Debian разработчики пишут гневные письма, уходят и
приходят из-за того, что не хотят впиливать systemd в один из старейших
дистрибутивов, а я (вот странно, бгг) так и не мог определиться, тру
systemd или не тру. С одной стороны, он заменил sysV с его явно
устаревшей системой самописного барахла, часто дистрозависимого и
сложноподдерживаемого, с другой стороны - к sysV все уже привыкли, а
systemd довольно большой и его еще надо изучать. И тут буквально на днях
я узнал о простой фиче, которая ускользнула от моего взгляда при
рассматривании systemd вблизи и которую я не преминул буквально тут же
опробовать на своем ноутбуке. Речь идет, как можно догадаться из
заголовка, о power management-е.

Как-то пару лет назад, когда ~~деревья были большие~~ я еще пользовался
федорой как основной системой, я захотел, чтобы мой ноутбук уходил в сон
и приходил из него назад. Уходить он уходил, но назад возвращаться
упорно не хотел. Я помню, что так и не смог совладать с этой проблемой
тогда и в моей подкорке прочно укоренилась уверенность, что управление
питанием в Linux-е сделано через жо\^W\^W не совсем хорошо. Но пару дней
назад на работе, когда я мельком сказал об этом, коллеги сообщили мне,
что темные времена давно уже прошли и мне надо попробовать еще разок.

По приходу домой я сел читать маны. Во мне сидела твердая уверенность,
что это надолго и вечер будет занят изучением прекрасных опций,
дописываемых к ядру и танцев с бубном в попытках собрать очередной
внеочередной модуль ядра. Через две минуты чтения я понял, что что-то
здесь не так, потому что попробовать мне предлагалось одну команду:

\> systemctl suspend

после выполнения которой система резко ушла в режим сна, из которого
также резко вернулась, когда я нажал кнопку на клавиатуре. Мое отношение
к systemd резко изменилось в положительную сторону.

З.Ы.

Хотелось бы еще напомнить про то, какие вообще режимы сохранения энергии
бывают. Во-первых, есть уже упомянутый suspend - это когда выключается
все, кроме оперативной памяти и энергия уходит понемногу на поддержание
ее во включенном состоянии. Во-вторых, есть hibernate - это когда
содержимое оперативной памяти сбрасывается в swap и компьютер
выключается, а при включении он считывает swap обратно. Это приводит к
более долгому включению, но энергия при этом не расходуется вообще, т.к.
компьютер полностью выключен и данные из RAM хранятся на HDD. В-третьих,
есть hybrid режим, это сочетание suspend и hibernate - содержимое памяти
сбрасывается на HDD и компьютер погружается в suspend, а если пребывает
в нем слишком долго и энергии батареи не хватает, то выключается
полностью. Это позволяет включать ноутбук очень быстро, если батарея еще
хоть сколько-нибудь держит (потому что, фактически, используется
suspend) и не терять содержимого сессии, если батарея разряжается
полностью (за счет сброса данных из RAM на HDD). Для сторонников
hibernate и hybrid режимов в systemctl предусмотрено еще две команды:

\> systemctl hibernate

\> systemctl hybrid-sleep
